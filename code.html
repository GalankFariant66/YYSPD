<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Pasien - Yayasan Ketenangan Jiwa dan Hati</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      background: #f0f4f8;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0 1rem 2rem;
      color: #333;
    }

    header {
      text-align: center;
      padding: 2rem 0 1rem;
      color: #2a4d69;
    }

    header h1 {
      margin: 0;
      font-weight: 600;
      font-size: 2rem;
      letter-spacing: 1px;
    }

    header p {
      margin: 0.25rem 0 0;
      font-weight: 400;
      font-size: 1.1rem;
      color: #4a90e2;
    }

    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(42, 77, 105, 0.1);
      padding: 2rem 2rem 3rem;
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem 2rem;
      margin-bottom: 2rem;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 0.3rem;
      color: #2a4d69;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1.5px solid #a3bcd9;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    select:focus {
      border-color: #4a90e2;
      outline: none;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    /* Gender radios styling */
    .gender-group {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-top: 0.3rem;
    }

    .gender-group label {
      font-weight: 500;
      color: #444;
      cursor: pointer;
    }

    input[type="radio"] {
      accent-color: #4a90e2;
      cursor: pointer;
      margin-right: 0.3rem;
      vertical-align: middle;
    }

    button {
      grid-column: 1 / -1;
      background: #4a90e2;
      color: white;
      padding: 0.75rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(74, 144, 226, 0.4);
      transition: background-color 0.3s ease;
      justify-self: center;
      width: 150px;
    }

    button:hover {
      background: #357abd;
    }

    .search-container {
      margin-bottom: 1.5rem;
      text-align: right;
    }

    .search-container input {
      width: 250px;
      max-width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1.5px solid #a3bcd9;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .search-container input:focus {
      border-color: #4a90e2;
      outline: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgb(42 77 105 / 0.1);
    }

    thead {
      background: #4a90e2;
      color: #fff;
    }

    th, td {
      padding: 12px 14px;
      text-align: left;
      border-bottom: 1px solid #e1e7f0;
      font-size: 0.95rem;
      vertical-align: middle;
    }

    tbody tr:hover {
      background-color: #eff5fc;
    }

    td.last-col {
      text-align: center;
      min-width: 120px;
    }

    .action-btn {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 5px 10px;
      margin: 0 2px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: background-color 0.3s ease;
    }

    .action-btn:hover {
      background: #357abd;
    }

    .action-btn.delete {
      background: #e24a4a;
    }

    .action-btn.delete:hover {
      background: #b23232;
    }

    @media (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
      }
      button {
        width: 100%;
      }
      .search-container {
        text-align: left;
        margin-bottom: 1rem;
      }
      td.last-col {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Yayasan Ketenangan Jiwa dan Hati</h1>
    <p>Pengelola Data Pasien</p>
  </header>
  <main>
    <form id="patient-form" autocomplete="off">
      <div>
        <label for="name">Nama Lengkap</label>
        <input type="text" id="name" name="name" placeholder="Masukkan nama lengkap" required />
      </div>
      <div>
        <label for="rm-number">Nomer RM</label>
        <input type="number" id="rm-number" name="rm-number" placeholder="Masukkan nomer RM" required />
      </div>
      <div class="full-width">
        <label for="birthplace">Tempat Lahir</label>
        <input type="text" id="birthplace" name="birthplace" placeholder="Masukkan tempat lahir" required />
      </div>
      <div class="full-width" style="margin-top: -1rem;">
        <label for="birthdate">Tanggal Lahir</label>
        <input type="date" id="birthdate" name="birthdate" required max="" />
      </div>
      <div class="full-width" style="margin-top: 0;">
        <label>Jenis Kelamin</label>
        <div class="gender-group">
          <label><input type="radio" name="gender" value="Laki-laki" required /> Laki-laki</label>
          <label><input type="radio" name="gender" value="Perempuan" /> Perempuan</label>
          <label><input type="radio" name="gender" value="Lainnya" /> Lainnya</label>
        </div>
      </div>
      <div class="full-width">
        <label for="medicine">Obat</label>
        <input type="text" id="medicine" name="medicine" placeholder="Masukkan obat yang diberikan" required />
      </div>
      <button type="submit" id="submit-button">Tambah Pasien</button>
    </form>

    <div class="search-container">
      <input type="text" id="search" placeholder="Cari data pasien..." aria-label="Cari data pasien" />
    </div>

    <table aria-label="Data Pasien">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Nomer RM</th>
          <th>Tempat Lahir</th>
          <th>Tanggal Lahir</th>
          <th>Umur</th>
          <th>Jenis Kelamin</th>
          <th>Obat</th>
          <th class="last-col">Aksi</th>
        </tr>
      </thead>
      <tbody id="patient-list">
        <!-- Patient data rows inserted here -->
      </tbody>
    </table>
  </main>

  <script>
    const form = document.getElementById('patient-form');
    const patientList = document.getElementById('patient-list');
    const searchInput = document.getElementById('search');
    const submitButton = document.getElementById('submit-button');

    let patients = JSON.parse(localStorage.getItem('patients')) || [];
    let editIndex = null; // null means add mode; otherwise edit mode

    // Set max date for birthdate input to today
    const birthdateInput = document.getElementById('birthdate');
    birthdateInput.max = new Date().toISOString().split('T')[0];

    // Calculate age based on birthdate
    function calculateAge(birthdate) {
      const today = new Date();
      const birth = new Date(birthdate);
      let age = today.getFullYear() - birth.getFullYear();
      const m = today.getMonth() - birth.getMonth();
      if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      return age;
    }

    // Render patients filtered according to current search input
    function renderPatients() {
      const filter = searchInput.value.trim().toLowerCase();
      patientList.innerHTML = '';

      const filteredPatients = patients.filter(p => {
        return (
          p.name.toLowerCase().includes(filter) ||
          p.rmNumber.toLowerCase().includes(filter) ||
          p.birthplace.toLowerCase().includes(filter) ||
          new Date(p.birthdate).toLocaleDateString('id-ID').includes(filter) ||
          p.gender.toLowerCase().includes(filter) ||
          p.medicine.toLowerCase().includes(filter)
        );
      });

      if (filteredPatients.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 8;
        td.style.textAlign = 'center';
        td.style.fontStyle = 'italic';
        td.textContent = filter ? 'Tidak ditemukan data pasien yang cocok' : 'Belum ada data pasien';
        tr.appendChild(td);
        patientList.appendChild(tr);
        return;
      }

      filteredPatients.forEach((patient, index) => {
        const actualIndex = patients.indexOf(patient);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${patient.name}</td>
          <td>${patient.rmNumber}</td>
          <td>${patient.birthplace}</td>
          <td>${new Date(patient.birthdate).toLocaleDateString('id-ID')}</td>
          <td>${calculateAge(patient.birthdate)}</td>
          <td>${patient.gender}</td>
          <td>${patient.medicine}</td>
          <td class="last-col">
            <button class="action-btn edit" data-index="${actualIndex}" aria-label="Edit data pasien ${patient.name}">Edit</button>
            <button class="action-btn delete" data-index="${actualIndex}" aria-label="Hapus data pasien ${patient.name}">Hapus</button>
          </td>
        `;
        patientList.appendChild(tr);
      });
    }

    function savePatients() {
      localStorage.setItem('patients', JSON.stringify(patients));
    }

    function fillForm(patient) {
      form.name.value = patient.name;
      form['rm-number'].value = patient.rmNumber;
      form.birthplace.value = patient.birthplace;
      form.birthdate.value = patient.birthdate;
      // set gender radio buttons
      [...form.gender].forEach(radio => {
        radio.checked = radio.value === patient.gender;
      });
      form.medicine.value = patient.medicine;
    }

    function resetForm() {
      form.reset();
      editIndex = null;
      submitButton.textContent = "Tambah Pasien";
    }

    form.addEventListener('submit', e => {
      e.preventDefault();

      const name = form.name.value.trim();
      const rmNumber = form['rm-number'].value.trim();
      const birthplace = form.birthplace.value.trim();
      const birthdate = form.birthdate.value;
      const gender = form.gender.value;
      const medicine = form.medicine.value.trim();

      if (editIndex === null) {
        // Add new
        patients.push({ name, rmNumber, birthplace, birthdate, gender, medicine });
      } else {
        // Edit existing
        patients[editIndex] = { name, rmNumber, birthplace, birthdate, gender, medicine };
      }
      savePatients();
      renderPatients();
      resetForm();
      form.name.focus();
    });

    patientList.addEventListener('click', e => {
      if (e.target.classList.contains('edit')) {
        const index = parseInt(e.target.dataset.index, 10);
        if (!isNaN(index)) {
          editIndex = index;
          fillForm(patients[index]);
          submitButton.textContent = "Simpan Perubahan";
          window.scrollTo({ top: 0, behavior: 'smooth' });
          form.name.focus();
        }
      } else if (e.target.classList.contains('delete')) {
        const index = parseInt(e.target.dataset.index, 10);
        if (!isNaN(index)) {
          const confirmed = confirm(`Apakah Anda yakin ingin menghapus data pasien "${patients[index].name}"?`);
          if (confirmed) {
            patients.splice(index, 1);
            savePatients();
            renderPatients();
            if (editIndex === index) {
              resetForm();
            }
          }
        }
      }
    });

    searchInput.addEventListener('input', () => {
      renderPatients();
    });

    // Initial render on load
    renderPatients();
  </script>
</body>
</html>

